---
id: iukmod8sf806y5l5xbt4keo
title: Garbage Collection
desc: ''
updated: 1668255219555
created: 1659518499428
---

## Гипотеза о поколениях

Согласно теории поколений, объекты «умирают молодыми» гораздо чаще, чем «старыми». Недавно созданный объект станет мусором с гораздо большей вероятностью. Именно поэтому сборщику мусора рационально проверять такие объекты чаще.

___

## Сборка мусора

Существует два подхода к сборке мусора:
* подсчет ссылок
* обход графа достихимых объектов

Подсчет ссылок имеет сложности с подсчетом циклицеских ссылок. Поэтому обход графа является основным подходом.

Обход графа осуществляется от GC Roots.

___

## GC Roots

GC Roots являются объектами, считающимися всегда достижимыми изначально.

К ним относятся:
* Class: Классы, загруженные системными ClassLoaders, включая статичные
* Stack Local: Локальные переменные и параметры методов хранимые на стеке
* Active Java Threads: Все активные Java потоки
* References: JNI (Java Native Interface) Native code Java objects created for JNI calls; contains local variables, parameters to JNI methods, and global JNI references

___

## Порядок сборки мусора

1. Вся память делится на молодое и старое поколение.
2. Молодое поколение делится на слоты Eden, Survivor Space 1 и 2 (S0 и S1).
3. Все новые объекты попадают в Eden.
4. При каждой проверке алгоритм перемещает живые объекты из Eden и одного из S-слотов в другой S-слот, затем полностью чистит проверенные слоты.
5. S-слоты алгоритм проверяет поочередно: если во время предыдущей проверки проверялись слоты Eden и S0, а живые объекты копировались в S1, во время следующей проверки проверяться будут уже Eden и S1, а живые объекты будут копироваться в S0.
7. Объекты, которые смогут прожить достаточно долго, перемещаются в старшее поколение. За это время они успевают пройти множество проверок и с большой долей вероятности и дальше будут оставаться живыми.

!["Heap schema"](assets/images/java-gc-heap-structure.png)

Permanent Generation начиная с JDK-9 называется Metaspace и имеет некоторые отличия от PermGen, например может динамически расширяться.
