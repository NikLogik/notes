---
id: zsm7gxfa2ps465j16vrxf85
title: AMPQ
desc: ''
updated: 1667575589286
created: 1667573943645
---

## Определение

&nbsp;
AMQP (Advanced Message Queuing Protocol) — открытый протокол для передачи сообщений между    
компонентами системы. Основная идея состоит в том, что отдельные подсистемы    
(или независимые приложения) могут обмениваться произвольным образом сообщениями    
через AMQP-брокер, который осуществляет маршрутизацию, возможно гарантирует доставку,    
распределение потоков данных, подписку на нужные типы сообщений.
&nbsp;
Протокол работает поверх TCP/IP

## Основные элементы протокола

AMQP основан на трех понятиях:

1. Сообщение (message) — единица передаваемых данных, основная его часть (содержание)    
никак не интерпретируется сервером, к сообщению могут быть прицеплены структурированные заголовки.  
&nbsp;
2. Точка обмена (exchange) — в нее отправляются сообщения. Точка обмена распределяет    
сообщения в одну или несколько очередей. При этом в точке обмена сообщения не хранятся.    
Точки обмена бывают трех типов:
   * fanout — сообщение передается во все прицепленные к ней очереди;
   * direct — сообщение передается в очередь с именем, совпадающим с ключом маршрутизации  
     (routing key) (ключ маршрутизации указывается при отправке сообщения);
   * topic — нечто среднее между fanout и exchange, сообщение передается в очереди,  
      для которых совпадает маска на ключ маршрутизации, например, app.notification.sms.* —  
      в очередь будут доставлены все сообщения, отправленные с ключами, начинающимися  
      на app.notification.sms;
&nbsp;
3. Очередь (queue) — здесь хранятся сообщения до тех пор, пока не будет забраны клиентом.    
Клиент всегда забирает сообщения из одной или нескольких очередей.
&nbsp;

## Краткое устойство

Сам протокол AMQP устроен достаточно интересно: на самом нижнем уровне определяется формат    
кодирования данных в бинарный вид для передачи по TCP-соединению, выше лежит формат передачи    
RPC-запросов между сервером и клиентом. Сама семантика работы с сообщениями, создания    
очередей и т.п. описывается в XML-спецификации, которая по сути задает RPC-интерфейс сервера    
и клиента.